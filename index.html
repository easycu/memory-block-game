<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"><title>ì•”ê¸° í¼ì¦ PRO v6.8</title><style>:root{--p:#2e7d32;--s:#66bb6a;--bg:#e8f5e9;--grid-bg:#a5d6a7;--cell-bg:#c8e6c9;--bonus:#fdd835;--excel:#1b5e20;--text:#1b5e20;--danger:#ef5350}*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0;user-select:none}body{font-family:-apple-system,'Pretendard',sans-serif;background:var(--bg);color:var(--text);width:100vw;height:100dvh;display:flex;flex-direction:column;align-items:center;overflow:hidden;touch-action:none}.screen{display:none;width:100%;max-width:450px;padding:env(safe-area-inset-top) 20px env(safe-area-inset-bottom) 20px;height:100%;flex-direction:column}.active{display:flex}@keyframes shake{0%{transform:translate(1px,1px)}10%{transform:translate(-1px,-2px)rotate(-1deg)}50%{transform:translate(-1px,2px)rotate(-1deg)}100%{transform:translate(1px,-2px)rotate(-1deg)}}.shaking{animation:shake .5s}.float-score{position:absolute;color:var(--bonus);font-weight:900;font-size:1.5rem;pointer-events:none;animation:up 1s ease-out forwards;z-index:100}@keyframes up{to{opacity:0;transform:translateY(-50px)scale(1.5)}}.header{display:flex;justify-content:space-between;align-items:center;padding:10px 0;min-height:70px;width:100%}#grid-container{flex:1;display:flex;align-items:center;justify-content:center;width:100%;position:relative}#grid{display:grid;grid-template-columns:repeat(8,1fr);gap:4px;background:var(--grid-bg);padding:6px;border-radius:12px;width:100%;aspect-ratio:1/1}.cell{background:var(--cell-bg);border-radius:4px;aspect-ratio:1/1;transition:.2s}.cell.filled{background:var(--p);transform:scale(.95);box-shadow:0 2px 4px rgba(0,0,0,.1)}.cell.bonus-filled{background:var(--bonus);transform:scale(.95)}.cell.clearing{background:var(--s);transform:scale(1.1);filter:brightness(1.2)}.cell.ghost{background:var(--p);opacity:.5;transform:scale(.95);box-shadow:inset 0 0 0 2px rgba(255,255,255,.3)}.cell.ghost-bonus{background:var(--bonus);opacity:.6;transform:scale(.95)}#tray{display:flex;justify-content:center;align-items:center;gap:8px;height:110px;margin-bottom:15px;background:#fff;border-radius:20px;padding:10px;width:100%;box-shadow:0 4px 10px rgba(0,0,0,.05)}.shape-preview{width:75px;height:75px;display:grid;grid-template-columns:repeat(5,1fr);gap:1px;border-radius:10px;padding:4px;background:#fff}.shape-preview.dragging{opacity:0;visibility:hidden}.preview-cell{aspect-ratio:1/1}.preview-cell.filled{background:var(--p);border-radius:1px}.preview-cell.bonus{background:var(--bonus);border-radius:1px}#drag-helper{position:fixed;z-index:1000;display:none;opacity:1;pointer-events:none}
/* v6.8: í”Œë¡œíŒ… ë¸”ë¡ ë””ìì¸ ë³€ê²½ (ìœ¤ê³½ì„  ìŠ¤íƒ€ì¼) */
#drag-helper .preview-cell.filled{background:rgba(46,125,50,0.1);border:3px solid var(--p);border-radius:4px;transform:scale(0.95);box-sizing:border-box}
#drag-helper .preview-cell.bonus{background:rgba(253,216,53,0.2);border:3px solid var(--bonus);border-radius:4px;transform:scale(0.95);box-sizing:border-box}
.menu-btn{width:100%;padding:16px;margin:8px 0;border:none;border-radius:15px;color:#fff;font-size:1.1rem;font-weight:bold;cursor:pointer;box-shadow:0 4px 6px rgba(0,0,0,.1)}.btn-game{background:var(--p)}.btn-manage{background:#8d6e63}.word-card{background:#fff;padding:15px;margin-bottom:10px;border-radius:12px;border-left:5px solid var(--p);box-shadow:0 2px 5px rgba(0,0,0,.05);position:relative}.word-list-container{flex:1;overflow-y:auto;margin:15px 0;width:100%}#quiz-modal{position:fixed;top:0;left:0;width:100vw;height:100dvh;background:rgba(0,0,0,.8);display:none;align-items:center;justify-content:center;z-index:9999;backdrop-filter:blur(5px)}.modal-inner{background:#fff;padding:25px;border-radius:25px;width:100%;max-width:360px;display:flex;flex-direction:column;align-items:center}#q-input{width:100%;height:100px;padding:12px;border:2px solid var(--grid-bg);border-radius:12px;font-size:1rem;margin-bottom:15px;resize:none}#q-text{width:100%;background:var(--bg);padding:15px;border-radius:12px;margin-bottom:15px;text-align:left;max-height:150px;overflow-y:auto;font-weight:500}#toast-container{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);z-index:9999;pointer-events:none;display:flex;justify-content:center;width:100%}.toast{background:rgba(46,125,50,.95);color:#fff;padding:12px 24px;border-radius:30px;font-weight:bold;opacity:0;transform:translateY(20px);transition:.3s}.toast.show{opacity:1;transform:translateY(0)}.toast.error{background:rgba(231,76,60,.95)}.toast.success{background:rgba(67,160,71,.95)}.toast.info{background:rgba(30,136,229,.95)}
.file-ops{display:flex;flex-wrap:wrap;gap:12px;width:100%;margin-top:20px}
.btn-outline{flex:1;min-width:30%;background:#fff;color:var(--text);border:3px solid #ccc;padding:18px 5px;border-radius:15px;font-size:1.1rem;font-weight:900;text-align:center}
.btn-append{background:#e8f5e9;border-color:var(--p);color:var(--p)}
#excel-area{display:none;width:100%;background:#fff;padding:10px;border:2px dashed var(--excel);border-radius:10px;margin-bottom:15px}
#excel-input{width:100%;height:60px;padding:8px;border:1px solid #ccc;border-radius:5px;font-family:monospace;white-space:pre}
#new-q, #new-a {flex:1;height:60px;padding:10px;border:1px solid #ddd;border-radius:8px;resize:none}
</style></head><body><div id="drag-helper"></div><div id="toast-container"></div><div id="screen-home" class="screen active"><div style="flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center"><div style="font-size:4.5rem;margin-bottom:15px">ğŸ§©</div><h1 style="color:var(--text)">ì•”ê¸° í¼ì¦ PRO</h1><div style="background:#fff;padding:10px 25px;border-radius:15px;margin:20px 0;font-weight:bold;box-shadow:0 2px 8px rgba(0,0,0,.05);color:var(--text)">BEST: <span id="high-score-home" style="color:var(--p)">0</span></div></div><div class="home-btns"><button class="menu-btn btn-game" onclick="startGame()">ê²Œì„ ì‹œì‘</button><button class="menu-btn btn-manage" onclick="showScreen('manage')">ë¬¸ì œ ê´€ë¦¬</button></div></div><div id="screen-game" class="screen"><div class="header"><button onclick="confirmExit()" style="padding:8px 15px;border-radius:10px;border:none;background:#fff;font-weight:bold;color:var(--text);box-shadow:0 2px 5px rgba(0,0,0,.1)">ğŸ  í™ˆ</button><div class="score-box"><div style="font-size:.7rem;color:#666;font-weight:bold">BEST <span id="high-score-game">0</span></div><div style="font-weight:900;font-size:1.5rem;color:var(--p)" id="score">0</div></div></div><div id="grid-container"><div id="grid"></div></div><div id="tray"></div><p style="font-size:.75rem;color:#888;text-align:center;margin-bottom:10px">ë¸”ë¡ì„ ë“œë˜ê·¸í•˜ì—¬ ì±„ìš°ì„¸ìš”</p></div><div id="screen-manage" class="screen"><h2 style="margin:15px 0;color:var(--text)">ë¬¸ì œ ê´€ë¦¬</h2><div style="background:#fff;padding:15px;border-radius:15px;box-shadow:0 2px 10px rgba(0,0,0,.05)"><div style="display:flex;gap:5px"><textarea id="new-q" placeholder="ë¬¸ì œ"></textarea><textarea id="new-a" placeholder="ì •ë‹µ"></textarea></div><button onclick="addWord()" class="menu-btn btn-game" style="margin:8px 0;padding:12px;font-size:.9rem">ì¶”ê°€</button><button class="menu-btn" style="background:var(--excel);margin:0 0 10px 0;padding:10px;font-size:.9rem" onclick="toggleExcel()">ğŸ“‹ ì—‘ì…€ ë¶™ì—¬ë„£ê¸°</button><div id="excel-area"><p style="font-size:.75rem;color:var(--excel);margin-bottom:5px"><b>ì‚¬ìš©ë²•:</b> ì—‘ì…€ [ë¬¸ì œ] [ì •ë‹µ] ë³µì‚¬ í›„ ë¶™ì—¬ë„£ê¸°</p><textarea id="excel-input" placeholder="Apple	ì‚¬ê³¼"></textarea><button class="menu-btn btn-game" style="margin:0;padding:8px;font-size:.8rem" onclick="parseExcel()">ì¼ê´„ ë“±ë¡</button></div><div class="file-ops"><button class="btn-outline" onclick="exportJSON()">ë‚´ë³´ë‚´ê¸°</button><button class="btn-outline" onclick="triggerFile('import')">ë®ì–´ì“°ê¸°</button><button class="btn-outline btn-append" onclick="triggerFile('append')">í•©ì¹˜ê¸°</button></div><input type="file" id="file-input" style="display:none" onchange="handleFile(event)" accept=".json"></div><div class="word-list-container" id="word-list"></div><button class="menu-btn" style="background:#8d6e63;margin-top:auto" onclick="showScreen('home')">ëŒì•„ê°€ê¸°</button></div><div id="quiz-modal"><div class="modal-inner"><h2 id="q-title" style="color:var(--p);margin-bottom:15px">ë³µìŠµ íƒ€ì„!</h2><div id="q-text"></div><textarea id="q-input" placeholder="ì •ë‹µ ì…ë ¥"></textarea><div id="q-feedback" style="margin-bottom:15px;font-weight:bold;font-size:.9rem;text-align:center"></div><button id="q-submit" class="menu-btn btn-game" onclick="checkQuizAnswer()" style="margin:0;padding:12px">í™•ì¸</button><button id="q-next" class="menu-btn btn-manage" style="display:none;margin:0;padding:12px" onclick="nextQuestion()">ë‹¤ìŒ</button></div></div><script>
function showToast(m,t='normal'){const c=document.getElementById('toast-container'),e=document.createElement('div');e.className=`toast ${t}`;e.innerText=m;c.appendChild(e);void e.offsetWidth;e.classList.add('show');setTimeout(()=>{e.classList.remove('show');setTimeout(()=>e.remove(),300)},2000)}
const AudioCtx=window.AudioContext||window.webkitAudioContext;let audioContext=null;
function initAudio(){if(!audioContext)audioContext=new AudioCtx;if(audioContext.state==='suspended')audioContext.resume()}
const snd={click:t=>{const o=audioContext.createOscillator(),g=audioContext.createGain();o.frequency.setValueAtTime(600,t);o.frequency.exponentialRampToValueAtTime(300,t+.1);g.gain.setValueAtTime(.1,t);g.gain.exponentialRampToValueAtTime(.01,t+.1);o.connect(g);g.connect(audioContext.destination);o.start(t);o.stop(t+.1)},place:t=>{const o=audioContext.createOscillator(),g=audioContext.createGain();o.frequency.setValueAtTime(200,t);o.frequency.exponentialRampToValueAtTime(50,t+.1);g.gain.setValueAtTime(.2,t);g.gain.exponentialRampToValueAtTime(.01,t+.1);o.type='triangle';o.connect(g);g.connect(audioContext.destination);o.start(t);o.stop(t+.15)},clear:t=>{[523.25,659.25,783.99,1046.5].forEach((f,i)=>{const o=audioContext.createOscillator(),g=audioContext.createGain();o.frequency.value=f;g.gain.setValueAtTime(.1,t+i*.05);g.gain.exponentialRampToValueAtTime(.01,t+i*.05+.3);o.connect(g);g.connect(audioContext.destination);o.start(t+i*.05);o.stop(t+i*.05+.3)})},correct:t=>{[523.25,659.25,783.99].forEach((f,i)=>{const o=audioContext.createOscillator(),g=audioContext.createGain();o.frequency.value=f;o.type='sine';g.gain.setValueAtTime(.1,t+i*.1);g.gain.linearRampToValueAtTime(0,t+i*.1+.4);o.connect(g);g.connect(audioContext.destination);o.start(t+i*.1);o.stop(t+i*.1+.4)})},wrong:t=>{const o=audioContext.createOscillator(),g=audioContext.createGain();o.type='sawtooth';o.frequency.setValueAtTime(150,t);o.frequency.linearRampToValueAtTime(100,t+.3);g.gain.setValueAtTime(.1,t);g.gain.linearRampToValueAtTime(0,t+.3);o.connect(g);g.connect(audioContext.destination);o.start(t);o.stop(t+.3)}};
function playSound(t){if(audioContext)snd[t](audioContext.currentTime)}
const SHAPES=[[[0,0],[0,1],[1,0],[1,1]],[[0,0],[1,0],[2,0],[3,0],[4,0]],[[0,0],[0,1],[0,2],[0,3],[0,4]],[[0,0],[1,0],[2,0]],[[0,0],[0,1],[0,2]],[[0,0],[1,0],[2,0],[2,1],[2,2]],[[0,0],[0,1],[0,2],[1,2],[2,2]],[[0,0],[1,1],[2,2],[3,3]],[[0,2],[1,2],[2,0],[2,1],[2,2]],[[0,1],[1,0],[1,1],[1,2],[2,1]],[[0,0],[0,1],[1,1],[1,2],[2,2]],[[0,0],[1,0],[1,1]],[[0,0],[0,1],[1,0]],[[0,0],[0,1],[0,2],[0,3]],[[0,0],[1,0],[2,0],[3,0]],[[0,0]]];
let score=0,highScore=localStorage.getItem('puzzleBest8x8')||0,grid=Array(64).fill(0),trayShapes=[],vocabulary=JSON.parse(localStorage.getItem('myVocab'))||[{q:"ì‹œì‘!",a:"O",wrongCount:0}],fileMode='import',quizDeck=[],isDragging=false,dragShapeIndex=null,ghostIndices=[],masterR=0,masterC=0;
const TOUCH_OFFSET=60;
function showScreen(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById('screen-'+id).classList.add('active');window.scrollTo(0,0);updateScores();if(id==='manage')renderWordList()}
function updateScores(){document.getElementById('high-score-home').innerText=highScore;document.getElementById('high-score-game').innerText=highScore;document.getElementById('score').innerText=score}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
function fillDeck(){quizDeck=[];for(let i=0;i<vocabulary.length;i++)quizDeck.push(i);shuffle(quizDeck)}
function startQuiz(){if(vocabulary.length<1){refillTray(0);return}curQuiz=0;quizCorrect=0;let f=[];let w=vocabulary.map((v,i)=>({idx:i,wrong:v.wrongCount})).filter(v=>v.wrong>0).map(v=>v.idx);if(w.length>0)f.push(w[Math.floor(Math.random()*w.length)]);while(f.length<3){if(quizDeck.length===0)fillDeck();const n=quizDeck.pop();if(vocabulary[n]&&!f.includes(n))f.push(n)}shuffle(f);sessionQuizzes=f.map(i=>vocabulary[i]);document.getElementById('quiz-modal').style.display='flex';showQuestion()}
function showQuestion(){const q=sessionQuizzes[curQuiz];document.getElementById('q-title').innerText=`ê²€í†  (${curQuiz+1}/3)`;document.getElementById('q-text').innerText=q.q;document.getElementById('q-input').value="";document.getElementById('q-feedback').innerText="";document.getElementById('q-submit').style.display="block";document.getElementById('q-next').style.display="none"}
function checkQuizAnswer(){const r=document.getElementById('q-input').value.trim(),i=r.replace(/\s/g,"").toUpperCase(),a=sessionQuizzes[curQuiz].a,ra=a.replace(/\s/g,"").toUpperCase(),fb=document.getElementById('q-feedback');let c=(i==="O"||i==="X")?(ra.charAt(0)===i):(i===ra);if(c){quizCorrect++;playSound('correct');if(sessionQuizzes[curQuiz].wrongCount>0)sessionQuizzes[curQuiz].wrongCount--;fb.innerHTML=`<span style='color:var(--s)'>ì •ë‹µ! âœ¨<br>${a}</span>`}else{playSound('wrong');sessionQuizzes[curQuiz].wrongCount=(sessionQuizzes[curQuiz].wrongCount||0)+1;fb.innerHTML=`<span style='color:var(--danger)'>ì˜¤ë‹µ! âŒ<br>${a}</span>`}localStorage.setItem('myVocab',JSON.stringify(vocabulary));document.getElementById('q-submit').style.display="none";document.getElementById('q-next').style.display="block"}
function nextQuestion(){curQuiz++;if(curQuiz<3)showQuestion();else{document.getElementById('quiz-modal').style.display='none';if(quizCorrect>=2)refillTray(quizCorrect);else{showToast("ë¶ˆí•©ê²©!",'error');setTimeout(startQuiz,1000)}}}
function refillTray(c){trayShapes=[0,1,2].map(()=>[...SHAPES[Math.floor(Math.random()*SHAPES.length)]]);if(c===3){const b=[[0,0]];b.isBonus=true;trayShapes.push(b)}renderTray();checkGameOver()}
function renderTray(){const t=document.getElementById('tray');t.innerHTML="";trayShapes.forEach((s,i)=>{if(!s)return;const d=document.createElement('div');d.className='shape-preview';d.id=`shape-${i}`;d.addEventListener('touchstart',e=>handleStart(e,i),{passive:false});d.addEventListener('touchmove',handleMove,{passive:false});d.addEventListener('touchend',handleEnd,{passive:false});d.addEventListener('mousedown',e=>handleStart(e,i));for(let r=0;r<5;r++)for(let c=0;c<5;c++){const el=document.createElement('div');el.className=s.some(p=>p[0]===r&&p[1]===c)?(s.isBonus?'preview-cell filled bonus':'preview-cell filled'):'preview-cell';el.dataset.r=r;el.dataset.c=c;d.appendChild(el)}t.appendChild(d)})}
function handleStart(e,i){if(e.cancelable)e.preventDefault();isDragging=true;dragShapeIndex=i;const s=trayShapes[i],h=document.getElementById('drag-helper');h.innerHTML="";const cs=document.querySelector('.cell').getBoundingClientRect().width;
let minR=5,minC=5,maxR=-1,maxC=-1;s.forEach(p=>{minR=Math.min(minR,p[0]);maxR=Math.max(maxR,p[0]);minC=Math.min(minC,p[1]);maxC=Math.max(maxC,p[1])});const centerC=(minC+maxC)/2;let minDist=999;s.forEach(p=>{if(p[0]===maxR){const dist=Math.abs(p[1]-centerC);if(dist<minDist){minDist=dist;masterR=p[0];masterC=p[1]}}});
h.style.display="grid";h.style.gridTemplateRows=`repeat(${maxR-minR+1},${cs}px)`;h.style.gridTemplateColumns=`repeat(${maxC-minC+1},${cs}px)`;h.style.gap="1px";h.style.width=(maxC-minC+1)*cs+(maxC-minC)+'px';h.style.height=(maxR-minR+1)*cs+(maxR-minR)+'px';
for(let r=minR;r<=maxR;r++)for(let c=minC;c<=maxC;c++){const el=document.createElement('div');const ip=s.some(p=>p[0]===r&&p[1]===c);el.className=ip?(s.isBonus?'preview-cell filled bonus':'preview-cell filled'):'preview-cell';if(!ip)el.style.visibility="hidden";h.appendChild(el)}
moveHelper(e);e.currentTarget.classList.add('dragging');playSound('click');ghostIndices=[]}
function handleMove(e){if(!isDragging)return;if(e.cancelable)e.preventDefault();moveHelper(e);updateGhost(e)}
function handleEnd(e){if(!isDragging)return;isDragging=false;document.getElementById('drag-helper').style.display="none";document.querySelectorAll('.shape-preview').forEach(el=>el.classList.remove('dragging'));if(ghostIndices.length>0)placeBlock(ghostIndices,trayShapes[dragShapeIndex]);else clearGhost();ghostIndices=[];dragShapeIndex=null}
function moveHelper(e){const h=document.getElementById('drag-helper'),cx=e.touches?e.touches[0].clientX:e.clientX,cy=e.touches?e.touches[0].clientY:e.clientY,cs=document.querySelector('.cell').getBoundingClientRect().width,s=trayShapes[dragShapeIndex];let minR=5,minC=5;s.forEach(p=>{minR=Math.min(minR,p[0]);minC=Math.min(minC,p[1])});const relX=(masterC-minC)*cs+(cs/2);const relY=(masterR-minR)*cs+(cs/2);h.style.left=(cx-relX)+'px';h.style.top=(cy-TOUCH_OFFSET-relY)+'px'}
function updateGhost(e){clearGhost();ghostIndices=[];const cx=e.touches?e.touches[0].clientX:e.clientX,cy=e.touches?e.touches[0].clientY:e.clientY,cs=document.querySelector('.cell').getBoundingClientRect().width,h=document.getElementById('drag-helper');h.style.display='none';const el=document.elementFromPoint(cx,cy-TOUCH_OFFSET);h.style.display='grid';if(!el||!el.classList.contains('cell'))return;const id=parseInt(el.id.split('-')[1]),tr=Math.floor(id/8),tc=id%8,s=trayShapes[dragShapeIndex],sr=tr-masterR,sc=tc-masterC,inds=[];const fit=s.every(p=>{const nr=p[0]+sr,nc=p[1]+sc;if(nr>=0&&nr<8&&nc>=0&&nc<8&&grid[nr*8+nc]===0){inds.push(nr*8+nc);return true}return false});if(fit){ghostIndices=inds;inds.forEach(i=>document.getElementById('cell-'+i).classList.add(s.isBonus?'ghost-bonus':'ghost'))}}
function clearGhost(){document.querySelectorAll('.cell').forEach(c=>{c.classList.remove('ghost');c.classList.remove('ghost-bonus')})}
function placeBlock(i,s){playSound('place');i.forEach(x=>{grid[x]=1;document.getElementById('cell-'+x).className=s.isBonus?'cell bonus-filled':'cell filled'});trayShapes[dragShapeIndex]=null;renderTray();checkLines();if(trayShapes.every(v=>v===null))startQuiz();else checkGameOver()}
function checkLines(){let r=[],c=[];for(let i=0;i<8;i++){if(grid.slice(i*8,i*8+8).every(v=>v===1))r.push(i);let l=[];for(let j=0;j<8;j++)l.push(grid[j*8+i]);if(l.every(v=>v===1))c.push(i)}if(r.length+c.length>0){playSound('clear');const g=document.getElementById('grid');g.classList.remove('shaking');void g.offsetWidth;g.classList.add('shaking');const sc=(r.length+c.length)*10*(r.length+c.length);score+=sc;updateScores();const e=document.createElement('div');e.className='float-score';e.innerText=`+${sc}`;document.getElementById('grid-container').appendChild(e);setTimeout(()=>e.remove(),1000);if(score>highScore){highScore=score;localStorage.setItem('puzzleBest8x8',highScore)}}r.forEach(i=>{for(let k=0;k<8;k++)animateClear(i*8+k)});c.forEach(i=>{for(let k=0;k<8;k++)animateClear(k*8+i)})}
function animateClear(i){grid[i]=0;const e=document.getElementById('cell-'+i);e.classList.add('clearing');setTimeout(()=>e.className='cell',300)}
function checkGameOver(){const ok=trayShapes.some(s=>{if(!s)return false;for(let i=0;i<64;i++){const r=Math.floor(i/8),c=i%8;if(s.every(p=>{const nr=r+p[0],nc=c+p[1];return nr<8&&nc<8&&grid[nr*8+nc]===0}))return true}return false});if(!ok&&!trayShapes.every(v=>v===null)){showToast(`ê²Œì„ ì¢…ë£Œ! ì ìˆ˜: ${score}`,'info');setTimeout(()=>showScreen('home'),2000)}}
function startGame(){initAudio();if(vocabulary.length<1)return showToast("ë¬¸ì œë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”!",'error');showScreen('game');initGame()}
function initGame(){score=0;grid.fill(0);updateScores();const g=document.getElementById('grid');g.innerHTML="";for(let i=0;i<64;i++){const c=document.createElement('div');c.className='cell';c.id='cell-'+i;g.appendChild(c)}refillTray(0);fillDeck()}
function addWord(){const q=document.getElementById('new-q').value.trim(),a=document.getElementById('new-a').value.trim();if(q&&a){if(isDuplicate(q,a))return showToast("ì¤‘ë³µ!",'error');vocabulary.push({q,a,wrongCount:0});localStorage.setItem('myVocab',JSON.stringify(vocabulary));renderWordList();document.getElementById('new-q').value="";document.getElementById('new-a').value="";showToast("ì¶”ê°€ë¨!",'success');fillDeck()}else showToast("ì…ë ¥í•˜ì„¸ìš”",'error')}
function isDuplicate(q,a){const nQ=q.replace(/\s/g,"").toUpperCase(),nA=a.replace(/\s/g,"").toUpperCase();return vocabulary.some(v=>v.q.replace(/\s/g,"").toUpperCase()===nQ&&v.a.replace(/\s/g,"").toUpperCase()===nA)}
function toggleExcel(){const e=document.getElementById('excel-area');e.style.display=e.style.display==='none'?'block':'none'}
function parseExcel(){const r=document.getElementById('excel-input').value;if(!r.trim())return showToast("ì…ë ¥í•˜ì„¸ìš”",'error');const rows=r.split('\n');let c=0;rows.forEach(w=>{const s=w.split('\t');if(s.length>=2){const q=s[0].trim(),a=s[1].trim();if(q&&a&&!isDuplicate(q,a)){vocabulary.push({q,a,wrongCount:0});c++}}});localStorage.setItem('myVocab',JSON.stringify(vocabulary));renderWordList();document.getElementById('excel-input').value="";showToast(`${c}ê°œ ì¶”ê°€ë¨`,'success');toggleExcel();fillDeck()}
function renderWordList(){document.getElementById('word-list').innerHTML=vocabulary.map((v,i)=>`<div class="word-card"><b>${v.q}</b><br><small>${v.a}</small>${v.wrongCount>0?`<span style="color:var(--danger);font-size:0.7rem"><br>ğŸ”¥ë³µìŠµ(${v.wrongCount})</span>`:''}<button onclick="deleteWord(${i})" style="position:absolute;right:10px;top:10px;border:none;background:none;font-size:1.2rem;color:#ccc">âœ•</button></div>`).reverse().join('')}
function deleteWord(i){if(confirm("ì‚­ì œ?")){vocabulary.splice(i,1);localStorage.setItem('myVocab',JSON.stringify(vocabulary));renderWordList();fillDeck()}}
function triggerFile(m){fileMode=m;document.getElementById('file-input').click()}
function handleFile(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{try{const d=JSON.parse(ev.target.result);if(fileMode==='append'){let c=0;d.forEach(i=>{if(!isDuplicate(i.q,i.a)){vocabulary.push({...i,wrongCount:i.wrongCount||0});c++}});showToast(`${c}ê°œ ì¶”ê°€`,'info')}else{vocabulary=d.map(v=>({...v,wrongCount:v.wrongCount||0}));showToast("êµì²´ ì™„ë£Œ",'success')}localStorage.setItem('myVocab',JSON.stringify(vocabulary));renderWordList();fillDeck()}catch(err){showToast("ì˜¤ë¥˜",'error')}e.target.value=''};r.readAsText(f)}
function exportJSON(){const b=new Blob([JSON.stringify(vocabulary,null,2)],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(b);a.download=`quiz_backup.json`;a.click()}
function confirmExit(){if(confirm("ë‚˜ê°ˆê¹Œìš”?"))showScreen('home')}
window.onload=updateScores;window.addEventListener('mousemove',e=>{if(isDragging){moveHelper(e);updateGhost(e)}});window.addEventListener('mouseup',e=>{if(isDragging)handleTouchEnd(e)});
</script>
</body>
</html>
